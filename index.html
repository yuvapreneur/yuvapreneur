<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>yuvapreneur.in ‚Äî Start your Cafe Journey</title>
  <meta name="description" content="12 modules ‚Ä¢ 90+ lessons ‚Ä¢ Proven roadmap. Read‚Äëonly eBook course with secure account access and Razorpay checkout." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#f8fafc;--card:#ffffff;--ink:#0f172a;--muted:#475569;--line:#e2e8f0;--accent:#0f172a;--brand:#0f172a;--warn:#f59e0b}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
    a{color:inherit}
    .container{max-width:1120px;margin:0 auto;padding:0 16px}
    .btn{display:inline-flex;align-items:center;gap:8px;border:none;border-radius:16px;padding:12px 18px;font-weight:600;cursor:pointer}
    .btn-primary{background:var(--brand);color:#fff}
    .btn-outline{background:#fff;border:1px solid var(--line);color:var(--ink)}
    .badge{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);background:#f1f5f9;color:#334155;font-size:12px;border-radius:999px;padding:6px 10px;text-transform:uppercase;letter-spacing:.06em}
    .grid{display:grid;gap:24px}
    .grid-2{grid-template-columns:1fr}
    @media(min-width:900px){.grid-2{grid-template-columns:1fr 1fr}}
    .card{background:var(--card);border:1px solid var(--line);border-radius:20px;padding:20px;box-shadow:0 1px 2px rgba(0,0,0,.03)}
    .hero h1{font-size:40px;line-height:1.1;margin:16px 0 0}
    @media(min-width:900px){.hero h1{font-size:52px}}
    .muted{color:var(--muted)}
    .pill{display:inline-flex;align-items:center;gap:8px;border-radius:999px;background:#fffbeb;border:1px solid #fde68a;padding:6px 10px;font-size:14px}
    ul.clean{list-style:none;margin:0;padding:0}
    .list{list-style:disc;padding-left:20px;color:#334155}
    .module{display:flex;gap:12px}
    .module-index{min-width:36px;height:36px;border-radius:12px;background:#f1f5f9;display:grid;place-items:center;font-weight:600}
    header.top{position:sticky;top:0;z-index:20;background:rgba(255,255,255,.8);backdrop-filter:saturate(180%) blur(10px);border-bottom:1px solid var(--line)}
    header .row{display:flex;align-items:center;justify-content:space-between;padding:12px 0}
    .logo{font-weight:700;font-size:20px;display:flex;align-items:center;gap:8px}
    .hidden{display:none}
    .input{display:flex;align-items:center;gap:8px;border:1px solid var(--line);border-radius:12px;padding:10px 12px;background:#fff}
    .input input{border:none;outline:0;width:100%;font-size:14px}
    .two{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:720px){.two{grid-template-columns:1fr 1fr}}
    .small{font-size:12px}
    .center{text-align:center}
    .footer{border-top:1px solid var(--line);margin-top:48px;padding:32px 0}
    .priceTag{display:flex;align-items:center;gap:12px;background:#0f172a;color:#fff;border-radius:16px;padding:12px 16px}
    .rupee{font-weight:700;font-size:22px}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:12px;background:#f1f5f9;border:1px solid var(--line);border-bottom-width:2px;border-radius:6px;padding:2px 6px}
    /* Reader hardening hints */
    #reader{user-select:none}
    #reader img{pointer-events:none}
  </style>
  <!-- Razorpay checkout loader -->
  <script src="https://checkout.razorpay.com/v1/checkout.js" async></script>
</head>
<body>
  <header class="top">
    <div class="container row">
      <div class="logo">üöÄ yuvapreneur.in</div>
      <div>
        <button class="btn btn-primary small" onclick="openLogin()">Login</button>
        <button class="btn btn-outline small" onclick="scrollToId('enroll')">Create account</button>
      </div>
    </div>
  </header>

  <main>
    <!-- HERO -->
    <section class="hero container" style="padding:48px 0 24px">
      <span class="badge">Complete Caf√© Business eBook Course</span>
      <h1>Start your Cafe Journey</h1>
      <p class="muted" style="margin-top:10px;font-size:18px">12 Modules ‚Ä¢ 90+ Lessons ‚Ä¢ Proven Roadmap</p>

      <div style="display:flex;gap:16px;align-items:center;margin-top:20px;flex-wrap:wrap">
        <div class="priceTag">
          <span>Launch Offer</span>
          <span class="rupee">‚Çπ1</span>
        </div>
        <div class="muted small">Will increase to <b>‚Çπ799</b> after the timer.<br>
          <span class="pill">‚è≥ Offer ends in <span id="countdown">--:--:--</span></span>
        </div>
      </div>
      <div style="display:flex;gap:12px;margin-top:20px;flex-wrap:wrap">
        <span class="small">üîí Read‚Äëonly ‚Äî downloads disabled</span>
        <span class="small">üõ°Ô∏è Secure account access</span>
        <span class="small">üìñ Modules unlock sequentially</span>
      </div>
      <div style="display:flex;gap:12px;margin-top:24px;flex-wrap:wrap">
        <button class="btn btn-primary" onclick="scrollToId('enroll')">Enroll Now (‚Çπ1)</button>
        <a class="btn btn-outline" href="#modules">See Modules ‚Üí</a>
      </div>
    </section>

    <!-- VISUAL -->
    <section class="container">
      <div class="grid grid-2">
        <div class="card">
          <h3 style="margin:0 0 6px">Course Overview</h3>
          <ul class="clean muted" style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px;font-size:14px">
            <li>‚úî 90+ lessons</li>
            <li>‚úî 2‚Äì4 hrs content</li>
            <li>‚úî Checklists & templates</li>
            <li>‚úî Lifetime access</li>
          </ul>
        </div>
        <div class="card">
          <h3 style="margin:0 0 6px">What you‚Äôll learn ‚Äî highlights</h3>
          <ul class="list">
            <li>Location, costs, and break-even planning</li>
            <li>Menu engineering & profitable pricing</li>
            <li>Instagram/GMB growth & local promos</li>
            <li>Licenses (FSSAI, GST, Fire) and SOPs</li>
            <li>Customer experience & loyalty blueprint</li>
            <li>Scale and franchise readiness</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- MODULES -->
    <section id="modules" class="container" style="padding:32px 0">
      <h2 style="margin:0 0 16px">What you‚Äôll learn ‚Äî 12 Modules</h2>
      <div class="grid grid-2">
        <!-- 12 modules -->
        <div class="card">
          <div class="module"><div class="module-index">1</div><div><b>Introduction to the Caf√© Industry</b><ul class="list"><li>Types of caf√©s & models</li><li>Indian market & trends</li><li>Opportunities</li></ul></div></div>
        </div>
        <div class="card">
          <div class="module"><div class="module-index">2</div><div><b>Research & Market Analysis</b><ul class="list"><li>Customer segments</li><li>Competitor & SWOT</li><li>Define your USP</li></ul></div></div>
        </div>
        <div class="card">
          <div class="module"><div class="module-index">3</div><div><b>Location Selection & Setup</b><ul class="list"><li>Footfall benchmarks</li><li>Rent ‚â§ 10% of sales</li><li>Access checklist</li></ul></div></div>
        </div>
        <div class="card">
          <div class="module"><div class="module-index">4</div><div><b>Financial Planning & Investment</b><ul class="list"><li>Startup & monthly costs</li><li>Revenue math</li><li>Break-even</li></ul></div></div>
        </div>
        <div class="card">
          <div class="module"><div class="module-index">5</div><div><b>Kitchen Setup & Operations</b><ul class="list"><li>Layout & zones</li><li>Equipment essentials</li><li>Hygiene SOPs</li></ul></div></div>
        </div>
        <div class="card">
          <div class="module"><div class="module-index">6</div><div><b>Hiring & Team Management</b><ul class="list"><li>Key roles & salaries</li><li>Training plans</li><li>Shift design</li></ul></div></div>
        </div>
        <div class="card">
          <div class="module"><div class="module-index">7</div><div><b>Menu Design & Pricing</b><ul class="list"><li>Menu engineering</li><li>Psychological pricing</li><li>Combos & add‚Äëons</li></ul></div></div>
        </div>
        <div class="card">
          <div class="module"><div class="module-index">8</div><div><b>Marketing: Online + Offline</b><ul class="list"><li>Instagram & GMB</li><li>Local promos</li><li>Paid ads basics</li></ul></div></div>
        </div>
        <div class="card">
          <div class="module"><div class="module-index">9</div><div><b>Licenses & Compliance</b><ul class="list"><li>FSSAI, GST, Fire</li><li>Shop Act/UDYAM</li><li>Record keeping</li></ul></div></div>
        </div>
        <div class="card">
          <div class="module"><div class="module-index">10</div><div><b>Technology & POS</b><ul class="list"><li>Billing, KDS, inventory</li><li>Delivery integrations</li><li>Analytics dashboards</li></ul></div></div>
        </div>
        <div class="card">
          <div class="module"><div class="module-index">11</div><div><b>Customer Experience & Loyalty</b><ul class="list"><li>Service design</li><li>Feedback loops</li><li>Loyalty blueprint</li></ul></div></div>
        </div>
        <div class="card">
          <div class="module"><div class="module-index">12</div><div><b>Scaling & Franchising</b><ul class="list"><li>Unit economics</li><li>SOPs for replication</li><li>Franchise readiness</li></ul></div></div>
        </div>
      </div>
    </section>

    <!-- ENROLL FORM -->
    <section id="enroll" class="container" style="padding:12px 0 32px">
      <div class="card">
        <h2 style="margin-top:0">Create your account</h2>
        <p class="muted">Fill the form to enroll. You‚Äôll pay securely via Razorpay and get instant access to Module 1. (Demo HTML ‚Äî connect your backend for OTP, auth, and payment verification.)</p>
        <form class="two" onsubmit="return enroll(event)">
          <label class="input"><span>üë§</span><input required name="name" placeholder="Full name" /></label>
          <label class="input"><span>üì±</span><input required name="phone" placeholder="Phone number" type="tel" /></label>
          <label class="input"><span>‚úâÔ∏è</span><input required name="email" placeholder="Email" type="email" /></label>
          <label class="input"><span>üè¢</span><input required name="profession" placeholder="Profession" /></label>
          <label class="input"><span>üèôÔ∏è</span><input required name="city" placeholder="City" /></label>
          <label class="input"><span>üó∫Ô∏è</span><input required name="state" placeholder="State" /></label>
          <label class="input" style="grid-column:1/-1"><span>üîí</span><input required name="password" placeholder="Create password" type="password" /></label>
          <div style="grid-column:1/-1;display:flex;align-items:center;gap:10px" class="small">
            <input type="checkbox" id="agree" checked /> <label for="agree">I agree to the Terms and Privacy Policy.</label>
          </div>
          <div style="grid-column:1/-1;display:flex;align-items:center;justify-content:space-between">
            <div class="small muted">Payable today: <b>‚Çπ1</b> (will be ‚Çπ799 later)</div>
            <button class="btn btn-primary" type="submit">Enroll & Pay ‚Üí</button>
          </div>
        </form>
      </div>
    </section>

    <!-- BONUSES -->
    <section class="container" style="padding:8px 0 32px">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
        <h2 style="margin:0">Exclusive Bonuses (Optional)</h2>
        <span class="small muted">Each unlocks in your account ‚Äî read online only</span>
      </div>
      <div class="grid grid-2" style="margin-top:16px">
        <div class="card">
          <div style="display:flex;gap:12px;align-items:flex-start">
            <div class="module-index" aria-hidden>üìÑ</div>
            <div>
              <b>Caf√© Menu Psychology Blueprint: Increasing AOV & Satisfaction</b>
              <p class="muted small">Design a menu that nudges high‚Äëmargin choices and lifts your average order value without feeling salesy.</p>
              <div style="display:flex;align-items:center;justify-content:space-between;margin-top:8px">
                <div class="small">‚Çπ399</div>
                <button class="btn btn-primary small" onclick="buyBonus('bonus-menu-psychology',399)">Buy & Access ‚Üí</button>
              </div>
            </div>
          </div>
        </div>
        <div class="card">
          <div style="display:flex;gap:12px;align-items:flex-start">
            <div class="module-index" aria-hidden>üè∑Ô∏è</div>
            <div>
              <b>Festival & Seasonal Marketing Guide: Strategies to Double Sales</b>
              <p class="muted small">Plan irresistible festival offers, content, and promos that turn holidays into revenue spikes.</p>
              <div style="display:flex;align-items:center;justify-content:space-between;margin-top:8px">
                              <div class="small">‚Çπ1</div>
              <button class="btn btn-primary small" onclick="buyBonus('bonus-seasonal-marketing',1)">Buy & Access ‚Üí</button>
              </div>
            </div>
          </div>
        </div>
        <div class="card">
          <div style="display:flex;gap:12px;align-items:flex-start">
            <div class="module-index" aria-hidden>üõ°Ô∏è</div>
            <div>
              <b>How to Create a Caf√© Loyalty Program: Simple, Effective Strategies</b>
              <p class="muted small">Launch a no‚Äëfuss loyalty system that boosts repeat visits ‚Äî even without expensive software.</p>
              <div style="display:flex;align-items:center;justify-content:space-between;margin-top:8px">
                <div class="small">‚Çπ249</div>
                <button class="btn btn-primary small" onclick="buyBonus('bonus-loyalty',249)">Buy & Access ‚Üí</button>
              </div>
            </div>
          </div>
        </div>
        <div class="card">
          <div style="display:flex;gap:12px;align-items:flex-start">
            <div class="module-index" aria-hidden>üì∑</div>
            <div>
              <b>Photography Cheat Sheet: Mouth‚Äëwatering Caf√© Food Pics on Phone</b>
              <p class="muted small">Shoot scroll‚Äëstopping food photos using only your phone ‚Äî lighting, angles, styling, and quick edits.</p>
              <div style="display:flex;align-items:center;justify-content:space-between;margin-top:8px">
                <div class="small">‚Çπ229</div>
                <button class="btn btn-primary small" onclick="buyBonus('bonus-food-photo',229)">Buy & Access ‚Üí</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- FAQ -->
    <section class="container" style="padding:8px 0 40px">
      <h2>Q&A ‚Äî Frequently Asked Questions</h2>
      <div class="grid">
        <details class="card"><summary><b>Will I be able to download the eBook?</b></summary><p class="muted">No. Access is read‚Äëonly inside your account to protect course IP. Downloads and print are disabled.</p></details>
        <details class="card"><summary><b>How do modules unlock?</b></summary><p class="muted">After successful payment, Module 1 unlocks instantly. Each subsequent module unlocks after you complete the previous one.</p></details>
        <details class="card"><summary><b>Is ‚Çπ1 a lifetime deal?</b></summary><p class="muted">Yes, for early buyers during the countdown. After the timer, the price switches to ‚Çπ799.</p></details>
        <details class="card"><summary><b>How do I reset my password?</b></summary><p class="muted">Use ‚ÄúForgot password‚Äù. Enter your phone or email to receive an OTP, then set a new password.</p></details>
        <details class="card"><summary><b>How is payment handled?</b></summary><p class="muted">Payments go through Razorpay‚Äôs secure checkout. You‚Äôll be redirected back automatically after success.</p></details>
      </div>
      <p class="small muted" style="margin-top:12px">‚ö†Ô∏è If you face any issues, email <a href="mailto:supportyuvapreneur@gmail.com">supportyuvapreneur@gmail.com</a>.</p>
    </section>

    <!-- READER (demo placeholder) -->
    <section id="reader" class="container" style="padding-bottom:24px">
      <div class="card">
        <h2 style="margin:0 0 8px">Your Course Reader</h2>
        <p class="muted small" id="readerStatus">Please login to access your modules.</p>
        <div id="modulesList" class="clean small" style="display:grid;gap:8px;margin-top:8px"></div>
        <div id="readerContent" class="muted" style="margin-top:12px"></div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="container" style="display:grid;gap:20px;grid-template-columns:1fr;align-items:start">
      <div>
        <b>yuvapreneur.in</b>
        <p class="muted small">Learn, launch, and grow your caf√© business the right way.</p>
      </div>
      <div>
        <b>Support</b>
        <p class="muted small">Email: <a href="mailto:supportyuvapreneur@gmail.com">supportyuvapreneur@gmail.com</a></p>
        <p class="muted small">Refunds & terms available on request.</p>
      </div>
      <div>
        <b>Security</b>
        <ul class="clean small muted">
          <li>üîí Read‚Äëonly access (no downloads)</li>
          <li>üõ°Ô∏è OTP reset supported</li>
        </ul>
      </div>
    </div>
    <p class="small muted center">¬© <span id="yr"></span> yuvapreneur.in ‚Ä¢ All rights reserved.</p>
  </footer>

  <!-- LOGIN / FORGOT DIALOG (very simple demo) -->
  <dialog id="loginDlg" style="border:none;border-radius:16px;max-width:420px;width:calc(100% - 32px);padding:0;">
    <form method="dialog" class="card" style="margin:0">
      <h3 style="margin:0 0 8px">Login to your account</h3>
      <div class="input"><span>‚úâÔ∏è</span><input id="loginId" placeholder="Phone or Email" /></div>
      <div class="input" style="margin-top:8px"><span>üîí</span><input id="loginPass" type="password" placeholder="Password" /></div>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-top:12px">
        <button class="btn btn-primary" onclick="return doLogin(event)">Login</button>
        <button class="btn btn-outline" onclick="return openForgot(event)">Forgot password?</button>
      </div>
    </form>
  </dialog>

  <dialog id="forgotDlg" style="border:none;border-radius:16px;max-width:420px;width:calc(100% - 32px);padding:0;">
    <form method="dialog" class="card" style="margin:0">
      <h3 style="margin:0 0 8px">Reset password</h3>
      <div class="input"><span>‚úâÔ∏è</span><input id="fpId" placeholder="Phone or Email" /></div>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button class="btn btn-primary" onclick="return sendOtp(event)">Send OTP</button>
        <span id="otpSentMsg" class="small muted" style="display:none">OTP sent (demo)</span>
      </div>
      <div id="otpBlock" class="hidden" style="margin-top:8px">
        <div class="input"><span>üì≤</span><input id="fpOtp" placeholder="Enter OTP" /></div>
        <div class="input" style="margin-top:8px"><span>üîí</span><input id="fpNew" type="password" placeholder="New password" /></div>
        <button class="btn btn-outline" style="margin-top:8px" onclick="return doReset(event)">Reset Password</button>
      </div>
    </form>
  </dialog>

  <script>
    // Year
    document.getElementById('yr').textContent = new Date().getFullYear();

    // Countdown (48h)
    const target = new Date();
    target.setHours(target.getHours()+48, 0, 0, 0);
    const cd = document.getElementById('countdown');
    setInterval(()=>{
      const now = new Date();
      const diff = Math.max(0, target.getTime() - now.getTime());
      const h = String(Math.floor(diff/3.6e6)).padStart(2,'0');
      const m = String(Math.floor((diff%3.6e6)/6e4)).padStart(2,'0');
      const s = String(Math.floor((diff%6e4)/1e3)).padStart(2,'0');
      cd.textContent = `${h}:${m}:${s}`;
    },1000);

    // Configuration
    const RAZORPAY_KEY_ID = 'rzp_live_R6NyOWKBnKScPC';
    const API_BASE_URL = 'https://api.yuvapreneur.in'; // Replace with your actual API endpoint
    
    // Simple in-memory demo store (NOT PRODUCTION - replace with your backend)
    const store = { users: {}, modulesUnlocked: {} };

    function scrollToId(id){ document.getElementById(id).scrollIntoView({behavior:'smooth'}); }

    function openLogin(){ document.getElementById('loginDlg').showModal(); }
    function openForgot(e){ e && e.preventDefault(); document.getElementById('loginDlg').close(); document.getElementById('forgotDlg').showModal(); return false; }

    // Handle payment for main course
    async function handlePay(formData) {
      try {
        // Create order on your backend
        const response = await fetch(`${API_BASE_URL}/api/create-order`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            amount: 100, // ‚Çπ1 in paise
            currency: 'INR',
            customer: {
              name: formData.name,
              email: formData.email,
              phone: formData.phone
            },
            course: 'cafe-business-course'
          })
        });

        if (!response.ok) throw new Error('Failed to create order');
        
        const orderData = await response.json();
        
        // Initialize Razorpay
        const options = {
          key: RAZORPAY_KEY_ID,
          amount: orderData.amount,
          currency: orderData.currency,
          name: 'yuvapreneur.in',
          description: 'Caf√© Business 12-Module eBook Course',
          order_id: orderData.order_id,
          handler: function (response) {
            // Verify payment on backend
            verifyPayment(response, formData);
          },
          prefill: { 
            name: formData.name, 
            email: formData.email, 
            contact: formData.phone 
          },
          theme: { color: '#0f172a' },
          modal: {
            ondismiss: function() {
              console.log('Payment cancelled');
            }
          }
        };

        if (window.Razorpay) {
          new window.Razorpay(options).open();
        } else {
          alert('Razorpay not loaded. Please refresh the page.');
        }
      } catch (error) {
        console.error('Payment error:', error);
        alert('Failed to initiate payment. Please try again.');
      }
    }

    // Verify payment and grant access
    async function verifyPayment(response, formData) {
      try {
        const verifyResponse = await fetch(`${API_BASE_URL}/api/verify-payment`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            razorpay_payment_id: response.razorpay_payment_id,
            razorpay_order_id: response.razorpay_order_id,
            razorpay_signature: response.razorpay_signature,
            user_data: formData
          })
        });

        if (!verifyResponse.ok) throw new Error('Payment verification failed');
        
        const result = await verifyResponse.json();
        
        if (result.success) {
          // Store user data locally
          const key = formData.email || formData.phone;
          store.users[key] = { ...formData, paid: true, userId: result.userId };
          localStorage.setItem('yuv_userKey', key);
          
          // Redirect to main site
          window.location.href = 'https://www.yuvapreneur.in';
        } else {
          alert('Payment verification failed. Please contact support.');
        }
      } catch (error) {
        console.error('Verification error:', error);
        alert('Payment verification failed. Please contact support.');
      }
    }

    function enroll(e){
      e.preventDefault();
      const f = e.target;
      if(!document.getElementById('agree').checked){ 
        alert('Please accept terms to proceed.'); 
        return false; 
      }
      
      const form = Object.fromEntries(new FormData(f).entries());
      handlePay(form);
      return false;
    }

    // Authentication functions
    async function doLogin(e){
      e && e.preventDefault();
      const id = document.getElementById('loginId').value.trim();
      const pass = document.getElementById('loginPass').value;
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ identifier: id, password: pass })
        });

        if (!response.ok) throw new Error('Login failed');
        
        const result = await response.json();
        
        if (result.success) {
          localStorage.setItem('yuv_userKey', result.userId);
          localStorage.setItem('yuv_userToken', result.token);
          document.getElementById('loginDlg').close();
          document.getElementById('readerStatus').textContent = 'Logged in as ' + (result.user.name || 'User');
          renderModules(result.user.paid ? 1 : 0);
          
          // Redirect to main site if paid
          if (result.user.paid) {
            window.location.href = 'https://www.yuvapreneur.in';
          }
        } else {
          alert(result.message || 'Invalid credentials.');
        }
      } catch (error) {
        console.error('Login error:', error);
        alert('Login failed. Please try again.');
      }
      return false;
    }

    async function sendOtp(e){ 
      e && e.preventDefault(); 
      const id = document.getElementById('fpId').value.trim();
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/send-otp`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ identifier: id })
        });

        if (!response.ok) throw new Error('Failed to send OTP');
        
        const result = await response.json();
        
        if (result.success) {
          document.getElementById('otpSentMsg').style.display = 'inline';
          document.getElementById('otpBlock').classList.remove('hidden');
          document.getElementById('otpSentMsg').textContent = 'OTP sent to ' + (id.includes('@') ? 'email' : 'phone');
        } else {
          alert(result.message || 'Failed to send OTP');
        }
      } catch (error) {
        console.error('OTP error:', error);
        alert('Failed to send OTP. Please try again.');
      }
      return false; 
    }

    async function doReset(e){ 
      e && e.preventDefault(); 
      const id = document.getElementById('fpId').value.trim();
      const otp = document.getElementById('fpOtp').value;
      const newPass = document.getElementById('fpNew').value;
      
      try {
        const response = await fetch(`${API_BASE_URL}/api/reset-password`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            identifier: id, 
            otp: otp, 
            newPassword: newPass 
          })
        });

        if (!response.ok) throw new Error('Password reset failed');
        
        const result = await response.json();
        
        if (result.success) {
          alert('Password updated successfully. Please login.');
          document.getElementById('forgotDlg').close();
          document.getElementById('loginDlg').showModal();
        } else {
          alert(result.message || 'Password reset failed');
        }
      } catch (error) {
        console.error('Reset error:', error);
        alert('Password reset failed. Please try again.');
      }
      return false; 
    }

    // Secure reader with watermarking and protection
    function renderModules(unlocked){
      const list = document.getElementById('modulesList');
      const content = document.getElementById('readerContent');
      list.innerHTML=''; content.innerHTML='';
      
      if(!unlocked){ 
        content.textContent='Please complete payment to unlock Module 1.'; 
        return; 
      }
      
      const titles=[
        'Introduction to the Caf√© Industry','Research & Market Analysis','Location Selection & Setup','Financial Planning & Investment','Kitchen Setup & Operations','Hiring & Team Management','Menu Design & Pricing','Marketing: Online + Offline','Licenses & Compliance','Technology & POS','Customer Experience & Loyalty','Scaling & Franchising'
      ];
      
      for(let i=1;i<=12;i++){
        const btn = document.createElement('button');
        btn.textContent = i+'. '+titles[i-1];
        btn.className = 'btn btn-outline small';
        btn.style.justifyContent='space-between';
        btn.style.display='flex';
        btn.style.width='100%';
        if(i>unlocked){ btn.disabled=true; btn.style.opacity=.6; }
        btn.onclick=()=>{
          loadSecureContent(i, titles[i-1]);
        };
        list.appendChild(btn);
      }
      // open first by default
      list.querySelector('button').click();
    }

    // Load secure content with watermarking
    async function loadSecureContent(moduleId, title) {
      const content = document.getElementById('readerContent');
      const userKey = localStorage.getItem('yuv_userKey');
      const userToken = localStorage.getItem('yuv_userToken');
      
      try {
        // Fetch secure content from your protected API
        const response = await fetch(`${API_BASE_URL}/api/secure-content/${moduleId}`, {
          headers: {
            'Authorization': `Bearer ${userToken}`,
            'X-User-ID': userKey
          }
        });

        if (!response.ok) throw new Error('Failed to load content');
        
        const contentData = await response.json();
        
        // Render content with watermark
        content.innerHTML = `
          <div class="small muted">Module ${moduleId}</div>
          <h3>${title}</h3>
          <div class="secure-content" style="position:relative;padding:20px;background:#fff;border-radius:12px;border:1px solid var(--line);">
            <div class="watermark" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) rotate(-45deg);font-size:48px;color:rgba(0,0,0,0.1);pointer-events:none;user-select:none;z-index:1;">
              ${userKey}
            </div>
            <div style="position:relative;z-index:2;">
              ${contentData.content}
            </div>
          </div>
          <button class="btn btn-primary small" style="margin-top:8px" onclick="unlockNext(${moduleId})">Mark as Done</button>
        `;
        
        // Apply security measures
        applySecurityMeasures();
        
      } catch (error) {
        console.error('Content loading error:', error);
        content.innerHTML = `
          <div class="small muted">Module ${moduleId}</div>
          <h3>${title}</h3>
          <p>üìñ Secure content loading failed. Please refresh and try again.</p>
          <button class="btn btn-primary small" style="margin-top:8px" onclick="unlockNext(${moduleId})">Mark as Done</button>
        `;
      }
    }

    // Apply security measures to prevent copying/downloading
    function applySecurityMeasures() {
      const secureContent = document.querySelector('.secure-content');
      if (!secureContent) return;
      
      // Disable right-click
      secureContent.addEventListener('contextmenu', e => e.preventDefault());
      
      // Disable text selection
      secureContent.style.userSelect = 'none';
      secureContent.style.webkitUserSelect = 'none';
      secureContent.style.mozUserSelect = 'none';
      secureContent.style.msUserSelect = 'none';
      
      // Disable keyboard shortcuts
      document.addEventListener('keydown', e => {
        if (e.ctrlKey || e.metaKey) {
          if (['c', 'a', 's', 'p', 'u'].includes(e.key)) {
            e.preventDefault();
          }
        }
        if (e.key === 'F12') e.preventDefault();
      });
      
      // Disable print
      window.addEventListener('beforeprint', e => e.preventDefault());
    }

    window.unlockNext = function(current){
      const next = Math.min(12, current+1);
      renderModules(next);
    }

    // Bonus payment functionality
    async function buyBonus(bonusId, amount) {
      const userKey = localStorage.getItem('yuv_userKey');
      const userToken = localStorage.getItem('yuv_userToken');
      
      if (!userKey || !userToken) {
        alert('Please login to purchase bonuses.');
        openLogin();
        return;
      }

      try {
        // Create bonus order on your backend
        const response = await fetch(`${API_BASE_URL}/api/create-bonus-order`, {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${userToken}`,
            'X-User-ID': userKey
          },
          body: JSON.stringify({
            bonus_id: bonusId,
            amount: amount * 100, // Convert to paise
            currency: 'INR'
          })
        });

        if (!response.ok) throw new Error('Failed to create bonus order');
        
        const orderData = await response.json();
        
        // Initialize Razorpay for bonus
        const options = {
          key: RAZORPAY_KEY_ID,
          amount: orderData.amount,
          currency: orderData.currency,
          name: 'yuvapreneur.in',
          description: `Bonus: ${getBonusTitle(bonusId)}`,
          order_id: orderData.order_id,
          handler: function (response) {
            // Verify bonus payment
            verifyBonusPayment(response, bonusId, userKey, userToken);
          },
          prefill: { 
            name: store.users[userKey]?.name || '',
            email: store.users[userKey]?.email || '',
            contact: store.users[userKey]?.phone || ''
          },
          theme: { color: '#0f172a' }
        };

        if (window.Razorpay) {
          new window.Razorpay(options).open();
        } else {
          alert('Razorpay not loaded. Please refresh the page.');
        }
      } catch (error) {
        console.error('Bonus payment error:', error);
        alert('Failed to initiate bonus payment. Please try again.');
      }
    }

    // Verify bonus payment
    async function verifyBonusPayment(response, bonusId, userKey, userToken) {
      try {
        const verifyResponse = await fetch(`${API_BASE_URL}/api/verify-bonus-payment`, {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${userToken}`,
            'X-User-ID': userKey
          },
          body: JSON.stringify({
            razorpay_payment_id: response.razorpay_payment_id,
            razorpay_order_id: response.razorpay_order_id,
            razorpay_signature: response.razorpay_signature,
            bonus_id: bonusId
          })
        });

        if (!verifyResponse.ok) throw new Error('Bonus payment verification failed');
        
        const result = await verifyResponse.json();
        
        if (result.success) {
          alert('Bonus purchased successfully! You now have access to this content.');
          // Update UI to show bonus as purchased
          updateBonusUI(bonusId);
        } else {
          alert('Bonus payment verification failed. Please contact support.');
        }
      } catch (error) {
        console.error('Bonus verification error:', error);
        alert('Bonus payment verification failed. Please contact support.');
      }
    }

    // Get bonus title
    function getBonusTitle(bonusId) {
      const bonusTitles = {
        'bonus-menu-psychology': 'Caf√© Menu Psychology Blueprint',
        'bonus-seasonal-marketing': 'Festival & Seasonal Marketing Guide',
        'bonus-loyalty': 'Caf√© Loyalty Program Guide',
        'bonus-food-photo': 'Food Photography Cheat Sheet'
      };
      return bonusTitles[bonusId] || 'Bonus Content';
    }

    // Update bonus UI after purchase
    function updateBonusUI(bonusId) {
      const bonusCard = document.querySelector(`[onclick*="${bonusId}"]`).closest('.card');
      if (bonusCard) {
        const button = bonusCard.querySelector('button');
        button.textContent = '‚úì Purchased';
        button.disabled = true;
        button.style.opacity = '0.6';
        button.style.background = '#10b981';
      }
    }

    // Auto-login if present
    (function(){
      const k = localStorage.getItem('yuv_userKey');
      const token = localStorage.getItem('yuv_userToken');
      
      if(k && token){
        // Verify token with backend
        verifyTokenAndLogin(k, token);
      }
    })();

    // Verify token and auto-login
    async function verifyTokenAndLogin(userKey, token) {
      try {
        const response = await fetch(`${API_BASE_URL}/api/verify-token`, {
          headers: {
            'Authorization': `Bearer ${token}`,
            'X-User-ID': userKey
          }
        });

        if (response.ok) {
          const result = await response.json();
          if (result.valid) {
            document.getElementById('readerStatus').textContent = 'Logged in as ' + (result.user.name || 'User');
            renderModules(result.user.paid ? 1 : 0);
            
            // Redirect to main site if paid
            if (result.user.paid) {
              window.location.href = 'https://www.yuvapreneur.in';
            }
          } else {
            // Token expired, clear storage
            localStorage.removeItem('yuv_userKey');
            localStorage.removeItem('yuv_userToken');
          }
        }
      } catch (error) {
        console.error('Token verification error:', error);
        // Clear invalid tokens
        localStorage.removeItem('yuv_userKey');
        localStorage.removeItem('yuv_userToken');
      }
    }
  </script>
</body>
</html>
